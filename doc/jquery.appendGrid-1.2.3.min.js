/*!
* jQuery appendGrid v1.2.3
* https://appendgrid.apphb.com/
*
* Copyright 2014 Albert L.
* Dual licensed under the LGPL (http://www.gnu.org/licenses/lgpl.html)
* and MIT (http://www.opensource.org/licenses/mit-license.php) licenses.
*
* Depends:
* jQuery v1.9.1+
* jquery UI v1.10.2+
*/
(function(e){var n={caption:null,initRows:3,initData:null,firstCellWidth:32,lastCellWidth:89,columns:null,i18n:null,idPrefix:null,rowDragging:false,hideMoveUpDown:false,buttonClasses:null,dataLoaded:null,afterRowAppended:null,afterRowInserted:null,afterRowSwapped:null,beforeRowRemove:null,afterRowRemoved:null,_uniqueIndex:0,_rowOrder:null,_isDataLoaded:false,_visibleCount:0,_i18n:null,_buttonClasses:null};var r={type:"text",name:null,value:null,display:null,displayCss:null,cellCss:null,ctrlAttr:null,ctrlProp:null,ctrlCss:null,ctrlClass:null,ctrlOptions:null,uiOption:null,uiTooltip:null,customBuilder:null,customGetter:null,customSetter:null,onClick:null,onChange:null};var p={append:"Append Row",removeLast:"Remove Last Row",insert:"Insert Row Above",remove:"Remove Current Row",moveUp:"Move Up",moveDown:"Move Down",rowDrag:"Sort Row"};var j={append:null,removeLast:null,insert:null,remove:null,moveUp:null,moveDown:null,rowDrag:null};var i={init:function(F){var C=this;var B,u,E,w,y,v;if(C.length>0){if(!e.isArray(F.columns)||F.columns.length==0){alert("Cannot initial grid without column information!");return C}B=C[0];if(k(B.tagName)||B.tagName!="TABLE"){alert("Cannot initial grid on element other than TABLE!");return C}var x=e.extend({},n,F);if(e.isPlainObject(F.i18n)){x._i18n=e.extend({},p,F.i18n)}else{x._i18n=e.extend({},p)}if(e.isPlainObject(F.buttonClasses)){x._buttonClasses=e.extend({},j,F.buttonClasses)}else{x._buttonClasses=e.extend({},j)}x._rowOrder=[];if(k(x.idPrefix)){if(k(B.id)||B.id==""){x.idPrefix="ag"+new Date().getTime()}else{x.idPrefix=B.id}}u=document.createElement("thead");u.className="ui-widget-header";E=document.createElement("tbody");E.className="ui-widget-content";w=document.createElement("tfoot");w.className="ui-widget-header";e(B).empty().addClass("appendGrid").addClass("ui-widget").append(u,E,w);x._visibleCount=0;y=u.insertRow(-1);v=y.insertCell(-1);v.className="ui-widget-header";e(v).width(x.firstCellWidth);for(var D=0;D<x.columns.length;D++){var A=e.extend({},r,x.columns[D]);x.columns[D]=A;if(x.columns[D].type!="hidden"){x._visibleCount++;v=y.insertCell(-1);v.className="ui-widget-header";e(v).text(x.columns[D].display);if(x.columns[D].displayCss){e(v).css(x.columns[D].displayCss)}}}v=y.insertCell(-1);v.className="ui-widget-header";e(v).width(x.lastCellWidth);if(x.caption){y=u.insertRow(0);v=y.insertCell(-1);v.className="ui-state-active caption";v.colSpan=2+x._visibleCount;e(v).text(x.caption)}y=w.insertRow(-1);v=y.insertCell(-1);v.colSpan=2+x._visibleCount;e(v).append(e("<input/>").attr({type:"hidden",id:x.idPrefix+"_rowOrder",name:x.idPrefix+"_rowOrder"}).addClass("row-order"));e(v).append(e("<button/>").addClass(x._buttonClasses.append).attr({type:"button",title:x._i18n.append}).button({icons:{primary:"ui-icon-plusthick"},text:false}).click(function(){d(B,1,null,null)}));e(v).append(e("<button/>").addClass(x._buttonClasses.removeLast).attr({type:"button",title:x._i18n.removeLast}).button({icons:{primary:"ui-icon-closethick"},text:false}).click(function(){g(B,null,this.value,false)}));if(x.rowDragging){e(E).sortable({axis:"y",containment:B,handle:".rowDrag",helper:function(H,G){var I=G.children();var z=G.clone();z.children().each(function(J){e(this).width(I.eq(J).width())});return z},update:function(H,I){var z=I.item[0].id.substring(I.item[0].id.lastIndexOf("_")+1);var G=I.item[0].rowIndex-e("tr",u).length;m(B,I.originalPosition.top>I.position.top,z,G)}})}e(B).data("appendGrid",x);if(e.isArray(F.initData)){a(B,F.initData,true)}else{e(B).appendGrid("appendRow",x.initRows)}}return C},isReady:function(){var w=this,u=false;if(w.length>0){var v=w.first().data("appendGrid");if(v){u=true}}return u},isDataLoaded:function(){var w=this,u=null;if(this.length==1){var v=w.data("appendGrid");if(v){return v._isDataLoaded}else{return false}}else{return false}},load:function(u){var v=this;if(v.length>0){a(v[0],u,false)}return v},appendRow:function(u){return this.appendGrid("insertRow",u)},insertRow:function(x,B,v){var A=this;if(A.length>0){var u=A[0],z=null;var y=e(u).data("appendGrid");if(!y){alert("`appendGrid` does not initialized")}else{z=d(u,x||1,B,v);if(e.isNumeric(B)||e.isNumeric(v)){o(u,z.rowIndex);var w=y._rowOrder[z.addedRows[0]];e("#"+y.idPrefix+"_Insert_"+w,u).focus()}}}return A},removeRow:function(A,z){var y=this,B=-1;if(y.length>0){var x=y[0],u,C,w;var v=e(x).data("appendGrid");if(!v){alert("`appendGrid` does not initialized")}else{if(v._rowOrder.length>0){g(x,A,z,true)}}}return y},moveUpRow:function(A,z){var y=this,B=-1;if(y.length>0){var x=y[0],E,D,u,w;var v=e(x).data("appendGrid");if(!v){alert("`appendGrid` does not initialized")}else{var C=null;E=x.getElementsByTagName("tbody")[0];if(e.isNumeric(A)&&A>0&&A<v._rowOrder.length){C=A;z=v._rowOrder[A];D=document.getElementById(v.idPrefix+"_Row_"+z,x)}else{if(e.isNumeric(z)){C=f(z,v);D=document.getElementById(v.idPrefix+"_Row_"+z,x)}}if(C!=null&&C>0){u=document.getElementById(v.idPrefix+"_Row_"+v._rowOrder[C-1],x);E.removeChild(D);E.insertBefore(D,u);v._rowOrder[C]=v._rowOrder[C-1];v._rowOrder[C-1]=z;w=e("td.first",u).html();e("td.first",u).html(e("td.first",D).html());e("td.first",D).html(w);b(x,v);e("td.last button.moveUp",D).removeClass("ui-state-hover").blur();e("td.last button.moveUp",u).focus();if(v.afterRowSwapped){v.afterRowSwapped(x,C,C-1)}}}}return y},moveDownRow:function(A,z){var y=this,B=-1;if(y.length>0){var x=y[0],E,D,u,w;var v=e(x).data("appendGrid");if(!v){alert("`appendGrid` does not initialized")}else{var C=null;E=x.getElementsByTagName("tbody")[0];if(e.isNumeric(A)&&A>=0&&A<v._rowOrder.length-1){C=A;z=v._rowOrder[A];D=document.getElementById(v.idPrefix+"_Row_"+z,x)}else{if(e.isNumeric(z)){C=f(z,v);D=document.getElementById(v.idPrefix+"_Row_"+z,x)}}if(C!=null&&C!=v._rowOrder.length-1){u=document.getElementById(v.idPrefix+"_Row_"+v._rowOrder[C+1],x);E.removeChild(u);E.insertBefore(u,D);v._rowOrder[C]=v._rowOrder[C+1];v._rowOrder[C+1]=z;w=e("td.first",u).html();e("td.first",u).html(e("td.first",D).html());e("td.first",D).html(w);b(x,v);e("td.last button.moveDown",D).removeClass("ui-state-hover").blur();e("td.last button.moveDown",u).focus();if(v.afterRowSwapped){v.afterRowSwapped(x,C,C+1)}}}}return y},getRowCount:function(){var v=this;if(v.length>0){var u=v.data("appendGrid");if(u){return u._rowOrder.length}else{alert("`appendGrid` does not initialized")}}else{alert("Cannot get values on multiple grid")}return null},getUniqueIndex:function(w){var v=this;if(v.length>0&&w>=0){var u=v.data("appendGrid");if(u){if(w<u._rowOrder.length){return u._rowOrder[w]}}else{alert("`appendGrid` does not initialized")}}return null},getRowIndex:function(u){var w=this;if(w.length>0){var v=w.data("appendGrid");if(v){for(var x=0;x<v._rowOrder.length;x++){if(v._rowOrder[x]==u){return x}}return null}else{alert("`appendGrid` does not initialized")}}return null},getRowValue:function(z,v,y){var x=this,u=null;if(x.length>0){var w=x.data("appendGrid");if(w){if(e.isNumeric(z)&&z>=0&&z<w._rowOrder.length){v=w._rowOrder[z]}if(!k(v)){u=h(w,v,y)}}else{alert("`appendGrid` does not initialized")}}return u},getAllValue:function(x){var y=this,u=null,v;if(y.length>0){var w=e(y).data("appendGrid");if(w){u=x?{}:[];for(var A=0;A<w._rowOrder.length;A++){if(x){v=h(w,w._rowOrder[A],A);e.extend(u,v)}else{v=h(w,w._rowOrder[A]);u.push(v)}}if(x){u._RowCount=w._rowOrder.length}}}return u},getCtrlValue:function(u,x){var v=this;if(v.length>0){settings=v.data("appendGrid");if(settings&&x>=0&&x<settings._rowOrder.length){for(var w=0;w<settings.columns.length;w++){if(settings.columns[w].name===u){return c(settings,w,settings._rowOrder[x])}}}}return null},setCtrlValue:function(v,B,x){var y=this;if(y.length>0){var u=this,w=e(this).data("appendGrid");if(w&&B>=0&&B<w._rowOrder.length){for(var A=0;A<w.columns.length;A++){if(w.columns[A].name==v){l(w,A,w._rowOrder[B],x);break}}}}return y},getCellCtrl:function(w,v){var x=this,u=null;if(x.length==1){settings=x.data("appendGrid");if(!settings){alert("`appendGrid` does not initialized")}else{for(var y=0;y<settings.columns.length;y++){if(settings.columns[y].name===w){return q(settings.columns[y].type,settings.idPrefix,w,v);break}}}}return null},getCellCtrlByRowIndex:function(w,A){var x=this,u=null;if(x.length==1){settings=x.data("appendGrid");if(!settings){alert("`appendGrid` does not initialized")}else{if(A>=0&&A<settings._rowOrder.length){var v=settings._rowOrder[A];for(var y=0;y<settings.columns.length;y++){if(settings.columns[y].name===w){return q(settings.columns[y].type,settings.idPrefix,w,v)}}}}}return null},setCellCtrlByRowIndex:function(w,B,x){var y=this,u=null;if(y.length==1){settings=y.data("appendGrid");if(!settings){alert("`appendGrid` does not initialized")}else{if(B>=0&&B<settings._rowOrder.length){var v=settings._rowOrder[B];for(var A=0;A<settings.columns.length;A++){if(settings.columns[A].name===w){return setCellCtrl(settings.columns[A].type,settings.idPrefix,w,v,x)}}}}}return null},getRowOrder:function(){var w=this,u=null;if(this.length==1){var v=w.data("appendGrid");if(v){u=v._rowOrder.slice()}else{alert("`appendGrid` does not initialized")}}else{alert("Cannot get values on multiple grid")}return u}};function d(J,B,I,F){var N=e(J).data("appendGrid");var M=[],u=null,v,G,K=[];var w=J.getElementsByTagName("thead")[0];var D=J.getElementsByTagName("tbody")[0];if(e.isNumeric(F)){for(var C=0;C<N._rowOrder.length;C++){if(N._rowOrder[C]==F){I=C;if(C!=0){u=C-1}break}}}else{if(e.isNumeric(I)){if(I>=N._rowOrder.length){I=null}else{u=I-1}}else{if(N._rowOrder.length!=0){I=null;u=N._rowOrder.length-1}}}for(var C=0;C<B;C++){N._uniqueIndex++;v=N._uniqueIndex;K.length=0;if(e.isNumeric(I)){N._rowOrder.splice(I,0,v);tbRow=D.insertRow(I);M.push(I)}else{N._rowOrder.push(v);tbRow=D.insertRow(-1);M.push(N._rowOrder.length-1)}tbRow.id=N.idPrefix+"_Row_"+v;tbCell=tbRow.insertCell(-1);e(tbCell).addClass("ui-widget-content first").text(N._rowOrder.length).data("appendGrid",v);for(var E=0;E<N.columns.length;E++){if(N.columns[E].type=="hidden"){K.push(E);continue}tbCell=tbRow.insertCell(-1);tbCell.className="ui-widget-content";if(N.columns[E].cellCss!=null){e(tbCell).css(N.columns[E].cellCss)}G=null;if(N.columns[E].type=="custom"){if(typeof(N.columns[E].customBuilder)=="function"){G=N.columns[E].customBuilder(tbCell,N.idPrefix,N.columns[E].name,v)}}else{if(N.columns[E].type=="select"){G=document.createElement("select");G.id=N.idPrefix+"_"+N.columns[E].name+"_"+v;G.name=G.id;if(e.isArray(N.columns[E].ctrlOptions)){if(N.columns[E].ctrlOptions.length>0){if(e.isPlainObject(N.columns[E].ctrlOptions[0])){for(var H=0;H<N.columns[E].ctrlOptions.length;H++){G.options[G.options.length]=new Option(N.columns[E].ctrlOptions[H].label,N.columns[E].ctrlOptions[H].value)}}else{for(var H=0;H<N.columns[E].ctrlOptions.length;H++){G.options[G.options.length]=new Option(N.columns[E].ctrlOptions[H],N.columns[E].ctrlOptions[H])}}}}else{if(e.isPlainObject(N.columns[E].ctrlOptions)){for(var H in N.columns[E].ctrlOptions){G.options[G.options.length]=new Option(N.columns[E].ctrlOptions[H],H)}}else{if(typeof(N.columns[E].ctrlOptions)=="string"){var L=N.columns[E].ctrlOptions.split(";");for(var H=0;H<L.length;H++){var O=L[H].indexOf(":");if(-1==O){G.options[G.options.length]=new Option(L[H],L[H])}else{G.options[G.options.length]=new Option(L[H].substring(O+1,L[H].length),L[H].substring(0,O))}}}}}tbCell.appendChild(G)}else{if(N.columns[E].type=="checkbox"){G=document.createElement("input");G.type="checkbox";G.id=N.idPrefix+"_"+N.columns[E].name+"_"+v;G.name=G.id;G.value=1;tbCell.appendChild(G);tbCell.style.textAlign="center"}else{if(-1!=N.columns[E].type.search(/^(color|date|datetime|datetime\-local|email|month|number|range|search|tel|time|url|week)$/)){G=document.createElement("input");try{G.type=N.columns[E].type}catch(A){}G.id=N.idPrefix+"_"+N.columns[E].name+"_"+v;G.name=G.id;tbCell.appendChild(G)}else{G=document.createElement("input");G.type="text";G.id=N.idPrefix+"_"+N.columns[E].name+"_"+v;G.name=G.id;tbCell.appendChild(G);if(N.columns[E].type=="ui-datepicker"){e(G).datepicker(N.columns[E].uiOption)}else{if(N.columns[E].type=="ui-spinner"){e(G).spinner(N.columns[E].uiOption)}else{if(N.columns[E].type=="ui-autocomplete"){e(G).autocomplete(N.columns[E].uiOption)}}}}}}}if(N.columns[E].type!="custom"){if(N.columns[E].ctrlAttr!=null){e(G).attr(N.columns[E].ctrlAttr)}if(N.columns[E].ctrlProp!=null){e(G).prop(N.columns[E].ctrlProp)}if(N.columns[E].ctrlCss!=null){e(G).css(N.columns[E].ctrlCss)}if(N.columns[E].ctrlClass!=null){e(G).addClass(N.columns[E].ctrlClass)}if(N.columns[E].uiTooltip){e(G).tooltip(N.columns[E].uiTooltip)}if(typeof(N.columns[E].onClick)=="function"){e(G).click({caller:J,callback:N.columns[E].onClick,uniqueIndex:v},function(x){x.data.callback(x,e(x.data.caller).appendGrid("getRowIndex",x.data.uniqueIndex))})}if(typeof(N.columns[E].onChange)=="function"){e(G).change({caller:J,callback:N.columns[E].onChange,uniqueIndex:v},function(x){x.data.callback(x,e(x.data.caller).appendGrid("getRowIndex",x.data.uniqueIndex))})}}if(!k(N.columns[E].value)){l(N,E,v,N.columns[E].value)}}tbCell=tbRow.insertCell(-1);tbCell.className="ui-widget-content last";e(tbCell).append(e("<button/>").addClass("insert",N._buttonClasses.insert).val(v).attr({id:N.idPrefix+"_Insert_"+v,type:"button",title:N._i18n.insert,tabindex:-1}).button({icons:{primary:"ui-icon-arrowreturnthick-1-w"},text:false}).click(function(){e(J).appendGrid("insertRow",1,null,this.value)}));e(tbCell).append(e("<button/>").addClass("delete",N._buttonClasses.remove).val(v).attr({id:N.idPrefix+"_Delete_"+v,type:"button",title:N._i18n.remove,tabindex:-1}).button({icons:{primary:"ui-icon-trash"},text:false}).click(function(){g(J,null,this.value,false)}));if(!N.hideMoveUpDown){e(tbCell).append(e("<button/>").addClass("moveUp",N._buttonClasses.moveUp).val(v).attr({id:N.idPrefix+"_MoveUp_"+v,type:"button",title:N._i18n.moveUp,tabindex:-1}).button({icons:{primary:"ui-icon-arrowthick-1-n"},text:false}).click(function(){e(J).appendGrid("moveUpRow",null,this.value)}));e(tbCell).append(e("<button/>").addClass("moveDown",N._buttonClasses.moveDown).val(v).attr({id:N.idPrefix+"_MoveDown_"+v,type:"button",title:N._i18n.moveDown,tabindex:-1}).button({icons:{primary:"ui-icon-arrowthick-1-s"},text:false}).click(function(){e(J).appendGrid("moveDownRow",null,this.value)}))}if(N.rowDragging){e(tbCell).append(e("<div/>").attr("title",N._i18n.rowDrag).addClass("rowDrag ui-state-default ui-corner-all",N._buttonClasses.rowDrag).append(e("<div/>").addClass("ui-icon ui-icon-carat-2-n-s")))}for(var E=0;E<K.length;E++){G=document.createElement("input");G.id=N.idPrefix+"_"+N.columns[K[E]].name+"_"+v;G.name=G.id;G.type="hidden";if(!k(N.columns[K[E]].value)){G.value=N.columns[K[E]].value}tbCell.appendChild(G)}}b(J,N);if(e.isNumeric(I)){if(typeof(N.afterRowInserted)=="function"){N.afterRowInserted(J,u,M)}}else{if(typeof(N.afterRowAppended)=="function"){N.afterRowAppended(J,u,M)}}return{addedRows:M,parentIndex:u,rowIndex:I}}function g(v,B,u,x){var w=e(v).data("appendGrid");var A=v.getElementsByTagName("tbody")[0];if(e.isNumeric(u)){for(var y=0;y<w._rowOrder.length;y++){if(w._rowOrder[y]==u){B=y;break}}}if(e.isNumeric(B)){if(x||typeof(w.beforeRowRemove)!="function"||w.beforeRowRemove(v,B)){w._rowOrder.splice(B,1);A.deleteRow(B);b(v,w);o(v,B);if(typeof(w.afterRowRemoved)=="function"){w.afterRowRemoved(v,B)}}}else{if(x||typeof(w.beforeRowRemove)!="function"||w.beforeRowRemove(v,w._rowOrder.length-1)){u=w._rowOrder.pop();A.deleteRow(-1);b(v,w);if(typeof(w.afterRowRemoved)=="function"){w.afterRowRemoved(v,null)}}}}function o(u,x){var v=e(u).data("appendGrid");for(var w=x;w<v._rowOrder.length;w++){e("#"+v.idPrefix+"_Row_"+v._rowOrder[w]+" td.first",u).text(w+1)}}function a(A,w,z){var E,y,v,B,D;var x=e(A).data("appendGrid");if(x){E=A.getElementsByTagName("tbody")[0];e(E).empty();x._rowOrder.length=0;x._uniqueIndex=0;if(w!=null&&w.length){D=d(A,w.length,null,null);for(var u=0;u<D.addedRows.length;u++){for(var C=0;C<x.columns.length;C++){l(x,C,x._rowOrder[u],w[u][x.columns[C].name])}}}x._isDataLoaded=true;if(z){x.initData=null}e(A).data("appendGrid",x);if(typeof(x.dataLoaded)=="function"){x.dataLoaded(A)}}}function f(u,v){for(var w=0;w<v._rowOrder.length;w++){if(v._rowOrder[w]==u){return w}}return null}function k(u){return typeof(u)=="undefined"||u==null}function s(v,u){if(!k(v)&&e.isPlainObject(v)&&!k(v[u])){return v[u]}return null}function b(u,v){e(u).data("appendGrid",v);e("#"+v.idPrefix+"_rowOrder",u).val(v._rowOrder.join())}function t(v,u){var x=null;for(var w=0;w<v._rowOrder.length;w++){if(v._rowOrder[w]==u){return w}}return x}function h(x,v,A){var u={},w=null;for(var y=0;y<x.columns.length;y++){w=x.columns[y].name+(k(A)?"":"_"+A);u[w]=c(x,y,v)}return u}function c(y,w,u){var z=null,x=y.columns[w].type,v=y.columns[w].name;if(x=="checkbox"){z=q(x,y.idPrefix,v,u);if(z==null){return null}else{return z.checked?1:0}}else{if(x=="custom"){if(typeof(y.columns[w].customGetter)=="function"){return y.columns[w].customGetter(y.idPrefix,v,u)}else{return null}}else{z=q(x,y.idPrefix,v,u);if(z==null){return null}else{return z.value}}}}function q(w,x,v,u){return document.getElementById(x+"_"+v+"_"+u)}function l(y,w,u,z){var x=y.columns[w].type;var v=y.columns[w].name;if(x=="checkbox"){q(x,y.idPrefix,v,u).checked=(z!=null&&z!=0)}else{if(x=="custom"){if(typeof(y.columns[w].customSetter)=="function"){y.columns[w].customSetter(y.idPrefix,v,u,z)}}else{q(x,y.idPrefix,v,u).value=(z==null?"":z)}}}function m(v,B,u,w){var x=e(v).data("appendGrid");var A=-1;for(var y=0;y<x._rowOrder.length;y++){if(x._rowOrder[y]==u){if(B){A=w;x._rowOrder.splice(y,1);x._rowOrder.splice(w,0,u)}else{A=y;x._rowOrder.splice(w+1,0,u);x._rowOrder.splice(y,1)}break}}o(v,A);b(v,x)}e.fn.appendGrid=function(u){if(i[u]){return i[u].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof(u)==="object"||!u){return i.init.apply(this,arguments)}else{e.error("`"+u+"` method does not supported by appendGrid...")}}}})(jQuery);